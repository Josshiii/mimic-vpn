<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mimic Hub</title>
<style>
  :root { --bg: #1b2838; --panel: #171a21; --accent: #66c0f4; --green: #a4d007; --online: #57cbff; }
  body { background: var(--bg); color: #c6d4df; font-family: 'Inter', sans-serif; display: flex; height: 100vh; margin: 0; }
  
  .sidebar { width: 240px; background: var(--panel); padding: 15px; border-right: 1px solid #000; display: flex; flex-direction: column; }
  .main { flex: 1; padding: 20px; overflow-y: auto; background: rgba(0,0,0,0.2); }
  .friends-list { width: 220px; background: #121418; padding: 15px; border-left: 1px solid #000; }

  /* ESTILO AMIGOS */
  .friend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; font-size: 12px; }
  .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
  .status-dot.online { background: var(--online); box-shadow: 0 0 5px var(--online); }
  .friend-name { font-weight: bold; color: #fff; }
  .friend-game { color: var(--green); font-size: 10px; display: block; }

  /* TARJETAS DE LOBBY */
  .lobby-card { background: #2a475e; padding: 15px; border-radius: 4px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--green); }
  .btn-join { background: var(--green); color: #000; border: none; padding: 8px 15px; font-weight: bold; cursor: pointer; border-radius: 2px; }
</style>
    
      /* BARRA INFERIOR */
      .status-bar { height: 30px; background: #000; display: flex; align-items: center; padding: 0 10px; font-size: 11px; justify-content: space-between; }
      .oculto { display: none; }
    </style>
  </head>
  
<body>
  <div class="sidebar">
    <h2>MIMIC HUB</h2>
    <label>MI NICKNAME</label>
    <input id="my-name" value="Sasha">
    <label>JUEGO ACTUAL</label>
    <input id="my-game" value="Halo CE">
    <button id="btn-host" class="host-btn" style="margin-top:20px; background: var(--accent); color:#000; border:none; padding:10px; font-weight:bold; cursor:pointer;">CREAR SALA PÚBLICA</button>
  </div>

  <div class="main">
    <h3 style="margin-bottom:15px; font-size:14px; color:var(--accent);">PARTIDAS DISPONIBLES</h3>
    <div id="lobby-container"></div>
  </div>

  <div class="friends-list">
    <h3 style="font-size: 11px; color: #555; margin-bottom: 15px; letter-spacing: 1px;">AMIGOS EN LÍNEA</h3>
    <div id="friends-container"></div>
  </div>

  <script type="module">
    const invoke = window.__TAURI__.core.invoke;
    let ws;
    const SERVER_URL = "wss://mimic-signal.onrender.com";

    function connect() {
      ws = new WebSocket(SERVER_URL);
      ws.onopen = () => {
        // Al conectar, nos registramos socialmente
        ws.send(JSON.stringify({ type: 'HELLO', name: document.getElementById('my-name').value }));
      };

      ws.onmessage = (e) => {
        const msg = JSON.parse(e.data);
        if (msg.type === 'SOCIAL_UPDATE') {
          updateUI(msg.players, msg.lobbies);
        }
        if (msg.type === 'MATCH_FOUND') {
          // Lógica de inicio de túnel (mantener la que ya tienes)
          console.log("Conectando a:", msg.peer_ip);
        }
      };
    }

    function updateUI(players, lobbies) {
      // Actualizar Lista de Amigos
      const fContainer = document.getElementById('friends-container');
      fContainer.innerHTML = players.map(p => `
        <div class="friend-item">
          <div class="status-dot online"></div>
          <div>
            <span class="friend-name">${p.name}</span>
            <span class="friend-game">${p.game}</span>
          </div>
        </div>
      `).join('');

      // Actualizar Lista de Lobbies
      const lContainer = document.getElementById('lobby-container');
      const codes = Object.keys(lobbies);
      lContainer.innerHTML = codes.map(code => `
        <div class="lobby-card">
          <div>
            <div style="font-weight:bold; color:#fff;">${lobbies[code].gameName}</div>
            <div style="font-size:11px; color:var(--accent);">Host: ${lobbies[code].hostName}</div>
          </div>
          <button class="btn-join" onclick="window.join('${code}')">UNIRSE</button>
        </div>
      `).join('');
    }

    window.join = (code) => {
      ws.send(JSON.stringify({ type: 'JOIN', room: code, payload: "5000" }));
    };

    connect();
  </script>
</body>
</html>
